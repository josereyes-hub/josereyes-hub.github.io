<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArrancaYa</title>
    <!-- CDN de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fuente de Google: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Estilos CSS integrados -->
    <style>
        body {
            background-image: url(/Landing_Page_Img_2.png);
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            background-attachment: fixed;
            background-color: #1a202c; /* Color de fondo de respaldo */
        }
        .header-bg {
            background-color: #d1dbeb;
        }
        /* Estilos para el modal */
        .modal {
            display: none; /* Oculto por defecto */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            text-align: left;
            position: relative;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen text-gray-900 transition-colors duration-300 relative pt-80 md:pt-24">
    
    <!-- Encabezado reutilizable -->
    <header class="fixed top-0 z-50 w-full py-4 px-6 shadow-md flex flex-col items-center md:flex-row md:justify-between header-bg gap-2 md:gap-4">
        <!-- L√≠nea 1: T√≠tulo -->
        <h2 class="text-2xl md:text-3xl font-bold text-gray-800 flex-shrink-0">
            <a href="index.html">
                <span class="text-blue-500">Arranca</span><span class="text-orange-500">Ya</span>
            </a>
        </h2>
        
        <!-- L√≠nea 2: Barra de b√∫squeda -->
        <input type="search" id="searchBar" placeholder="¬øQu√© quieres aprender hoy?" class="w-full md:w-auto md:flex-grow px-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:border-indigo-500 transition-colors duration-200 min-w-0">
    
        <!-- L√≠nea 3: Buttons & Menu -->
        <div class="flex items-center justify-center md:justify-end w-full md:w-auto gap-4 flex-wrap">
            <!-- User Level Info -->
            <div class="text-base font-semibold text-gray-700 whitespace-nowrap">
                <a href="Rewards.html" class="hover:underline">
                    T√∫ nivel: <span class="font-bold text-green-600">Primeros pasos</span>
                </a>
            </div>
             <!-- Men√∫ desplegable principal -->
            <div class="relative">
                <!-- Bot√≥n del men√∫ -->
                <button id="menuButton" class="bg-green-700 hover:bg-green-800 text-white font-bold py-2 px-4 rounded-full focus:outline-none flex items-center space-x-2">
                    <div class="space-y-1">
                        <span class="block w-5 h-0.5 bg-white"></span>
                        <span class="block w-5 h-0.5 bg-white"></span>
                        <span class="block w-5 h-0.5 bg-white"></span>
                    </div>
                    <span class="text-sm md:text-base">Men√∫</span>
                </button>
                <!-- Contenido del men√∫ -->
                <div id="menuDropdown" class="absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg py-1 ring-1 ring-black ring-opacity-5 hidden z-50">
                    <a href="Profile.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Mi Perfil</a>
                    <a href="Allies.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Los que te impulsan</a>
                    <a href="Rewards.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">¬°Tu camino recorrido!</a>
                    <a href="Finance.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Lo que ganas y gastas</a>
                    <a href="Main_Options.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Opciones Principales</a>
                    <hr class="my-1">
                    <a href="Courses.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Cursos</a>
                    <a href="Advice.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Asesor√≠as</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Contenedor del contenido principal -->
    <main class="relative z-10 flex-grow flex flex-col items-center p-4 space-y-6 w-full">
        <h1 class="text-4xl md:text-5xl font-extrabold text-white text-center mb-8">Lo que ganas y gastas</h1>
        <!-- Fila superior -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-7xl">
            <div id="recordCard" class="p-4 bg-white/75 rounded-xl shadow-lg text-center text-gray-800 flex flex-col h-full justify-center space-y-2 border-4 border-blue-500">
                 <h3>¬°Olv√≠date de las cuentas!</h3><br>
                <h2 class="font-bold">Graba un audio de tu recibo</h2><br>
                <h3>¬°El sistema se encargar√° de anotar la informaci√≥n por ti!</h3>
                <p id="statusMessage" class="text-sm text-gray-500">Presiona para grabar</p>
                <div class="flex justify-center gap-4 mt-2">
                    <button id="recordButton" class="bg-red-500 hover:bg-red-600 text-white font-bold p-3 rounded-full focus:outline-none flex items-center justify-center">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"></path><path fill-rule="evenodd" d="M5.5 8.5A.5.5 0 016 9v1a4 4 0 004 4h.01a4 4 0 004-4V9a.5.5 0 011 0v1a5 5 0 01-4.5 4.975V17h3a.5.5 0 010 1h-7a.5.5 0 010-1h3v-2.025A5 5 0 015 10V9a.5.5 0 01.5-.5z" clip-rule="evenodd"></path></svg>
                    </button>
                    <button id="stopButton" class="bg-gray-700 hover:bg-gray-800 text-white font-bold p-3 rounded-full focus:outline-none flex items-center justify-center hidden">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a.5.5 0 01.5.5v5a.5.5 0 01-1 0v-5A.5.5 0 018 7zm4 0a.5.5 0 01.5.5v5a.5.5 0 01-1 0v-5A.5.5 0 0112 7z" clip-rule="evenodd"></path></svg>
                    </button>
                </div>
                <h3 class="flex items-center justify-center">
                    + 50 Puntos que te suben de nivel (por registro) <span class="ml-2 text-xl">üöÄ</span>
                </h3>
            </div>
            <div id="uploadDiv1" class="cursor-pointer p-4 bg-white/75 rounded-xl shadow-lg text-center text-gray-800 flex flex-col h-full justify-center space-y-1">
                <h3>¬°Olv√≠date de las cuentas!</h3><br>
                <h2 class="font-bold">¬°Escanea tu ticket aqu√≠!</h2><br>
                <h3>¬°El sistema se encargar√° de anotar la informaci√≥n por ti!</h3>
                <input type="file" id="fileInput1" class="hidden" accept="image/*" />
                <br>
                <h3 class="flex items-center justify-center">
                    + 50 Puntos que te suben de nivel (por registro) <span class="ml-2 text-xl">üöÄ</span>
                </h3>
            </div>
        </div>

        <!-- Nuevo Div a todo lo ancho: Resumen Semanal -->
        <div class="w-full max-w-7xl">
            <div class="bg-white/75 rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 text-center">Resumen de la Semana Pasada</h2>
                <p class="text-center text-gray-500 text-sm mb-6">(15 de Septiembre - 21 de Septiembre, 2025)</p>
                
                <!-- Contenedor principal con gr√°fico y leyenda -->
                <div class="flex flex-col md:flex-row items-center justify-center gap-8 md:gap-12">
                    
                    <!-- Gr√°fico de Dona (Donut Chart) -->
                    <div class="relative w-48 h-48">
                        <svg class="w-full h-full" viewBox="0 0 120 120">
                            <!-- Fondo del c√≠rculo (representa las ganancias totales) -->
                            <circle class="text-green-200" stroke-width="12" stroke="currentColor" fill="transparent" r="54" cx="60" cy="60" />
                            <!-- Arco de gastos -->
                            <circle class="text-red-500"
                                stroke-width="12"
                                stroke-dasharray="339.29"
                                stroke-dashoffset="245"
                                stroke-linecap="round"
                                stroke="currentColor"
                                fill="transparent"
                                r="54"
                                cx="60"
                                cy="60"
                                transform="rotate(-90 60 60)" />
                        </svg>
                        <!-- Texto en el centro -->
                        <div class="absolute inset-0 flex flex-col items-center justify-center text-center">
                            <span class="font-bold text-2xl text-blue-600">$3,249.50</span>
                            <span class="text-sm text-gray-600">Ganancia</span>
                        </div>
                    </div>

                    <!-- Leyenda y Resumen -->
                    <div class="space-y-4">
                        <!-- Ventas -->
                        <div class="flex items-center">
                            <span class="w-4 h-4 rounded-full bg-green-500 mr-3"></span>
                            <div>
                                <h3 class="font-semibold text-gray-700">Ventas Totales</h3>
                                <p class="font-bold text-xl text-green-600">$4,500.00</p>
                            </div>
                        </div>
                        <!-- Gastos -->
                        <div class="flex items-center">
                            <span class="w-4 h-4 rounded-full bg-red-500 mr-3"></span>
                            <div>
                                <h3 class="font-semibold text-gray-700">Gastos Totales</h3>
                                <p class="font-bold text-xl text-red-600">$1,250.50</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para mostrar resultados -->
    <div id="resultsModal" class="modal">
        <div class="modal-content">
            <button id="closeModal" class="absolute top-2 right-4 text-gray-500 hover:text-gray-900 text-3xl font-bold">&times;</button>
            <h3 id="modalTitle" class="font-bold text-2xl mb-4">Resultados</h3>
            <div id="modalContent">
                <!-- El contenido se cargar√° aqu√≠ din√°micamente -->
            </div>
        </div>
    </div>

    <!-- JavaScript para la interactividad -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // L√≥gica del men√∫ desplegable principal
            const menuButton = document.getElementById('menuButton');
            const menuDropdown = document.getElementById('menuDropdown');
    
            if (menuButton) {
                menuButton.addEventListener('click', (event) => {
                    if (menuDropdown) {
                        menuDropdown.classList.toggle('hidden');
                    }
                    event.stopPropagation();
                });
            }
    
            window.addEventListener('click', (event) => {
                if (menuDropdown && menuButton && !menuDropdown.contains(event.target) && !menuButton.contains(event.target)) {
                    menuDropdown.classList.add('hidden');
                }
            });
            
            // L√≥gica del modal
            const resultsModal = document.getElementById('resultsModal');
            const closeModalBtn = document.getElementById('closeModal');
            const modalTitle = document.getElementById('modalTitle');
    
            function showModal(title, content) {
                modalTitle.textContent = title;
                const modalContent = document.getElementById('modalContent');
                modalContent.innerHTML = content;
                resultsModal.style.display = 'flex';
            }
    
            function hideModal() {
                resultsModal.style.display = 'none';
            }
    
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', hideModal);
            }
    
            window.addEventListener('click', (event) => {
                if (event.target === resultsModal) {
                    hideModal();
                }
            });

            // L√≥gica de carga de archivos (para la tarjeta de escaneo)
            const uploadDiv1 = document.getElementById('uploadDiv1');
            const fileInput1 = document.getElementById('fileInput1');

            if (uploadDiv1 && fileInput1) {
                uploadDiv1.addEventListener('click', () => {
                    fileInput1.click();
                });

                fileInput1.addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (!file) return;

                    showModal('Procesando Imagen', `
                        <div class="text-center">
                            <p class="text-lg">Analizando... por favor espere.</p>
                            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto mt-4"></div>
                        </div>
                    `);

                    setTimeout(() => {
                        showModal('Resultados del Escaneo', `
                            <p><strong>Establecimiento:</strong> Papeler√≠a "El L√°piz Veloz"</p>
                            <p><strong>Fecha:</strong> 24/09/2025</p>
                            <p><strong>Total:</strong> $1,250.50</p>
                            <h5 class="font-bold mt-4">Art√≠culos:</h5>
                            <ul class="list-disc list-inside mt-2">
                                <li>Cajas de papel bond: $800.00</li>
                                <li>Bol√≠grafos y marcadores: $450.50</li>
                            </ul>
                            <p class="text-center font-semibold mt-4">La informaci√≥n se ha registrado con √©xito.</p>
                        `);
                    }, 2000);
                });
            }

            // L√≥gica de Speech-to-Text con Web Speech API (para la tarjeta de audio)
            const recordButton = document.getElementById('recordButton');
            const stopButton = document.getElementById('stopButton');
            const statusMessage = document.getElementById('statusMessage');
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            let recognition;

            if (SpeechRecognition) {
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.lang = 'es-MX';
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;

                recordButton.addEventListener('click', () => {
                    recognition.start();
                    statusMessage.textContent = "Escuchando...";
                    statusMessage.classList.add('text-red-500');
                    recordButton.classList.add('hidden');
                    stopButton.classList.remove('hidden');
                });

                stopButton.addEventListener('click', () => {
                    recognition.stop();
                    statusMessage.textContent = "Procesando...";
                });

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    const result = parseTranscript(transcript);
                    
                    if (result.total !== null) {
                        let title = 'Informaci√≥n Registrada';
                        let amountLabel = 'Monto';
                        let amountColor = 'text-gray-800';

                        if (result.type === 'gain') {
                            title = 'Ganancia Registrada';
                            amountLabel = 'Ganancia';
                            amountColor = 'text-green-600';
                        } else if (result.type === 'loss') {
                            title = 'Gasto Registrado';
                            amountLabel = 'Gasto';
                            amountColor = 'text-red-600';
                        }
                        
                        const modalContent = `
                            <p class="text-2xl font-bold ${amountColor}">${amountLabel}: $${result.total.toFixed(2)}</p>
                            <p class="text-center font-semibold mt-4">La informaci√≥n se ha registrado con √©xito.</p>
                        `;
                        showModal(title, modalContent);

                    } else {
                         const modalContent = `
                            <p>Esto fue lo que escuchamos:</p>
                            <blockquote class="mt-2 p-4 bg-gray-100 border-l-4 border-gray-500 text-gray-800 italic">
                                <p>"${transcript}"</p>
                            </blockquote>
                            <p class="mt-4 text-sm text-gray-600"><strong>Consejo:</strong> Intenta decir claramente una palabra clave (como "total", "gast√©", "vend√≠") seguida del monto.</p>
                        `;
                        showModal('No se identific√≥ un monto', modalContent);
                    }
                };
                
                function parseTranscript(text) {
                    const lowerText = text.toLowerCase();
                    const gainKeywords = ['vendi', 'vend√≠', 'ganar', 'gane', 'gan√©'];
                    const lossKeywords = ['pago de', 'gast√©', 'fueron', 'invert√≠', 'compr√©'];
                    const neutralKeywords = ['total'];

                    const allKeywords = [...gainKeywords, ...lossKeywords, ...neutralKeywords];
                    let total = null;
                    let type = null;

                    const regex = new RegExp(`(?:${allKeywords.join('|')})\\s*(?:de\\s*)?\\$?\\s*([\\d,]+(?:\\.\\d{1,2})?)`);
                    const match = lowerText.match(regex);
                    
                    if (match && match[1]) {
                        total = parseFloat(match[1].replace(/,/g, ''));
                        const matchedPhrase = match[0];

                        if (gainKeywords.some(kw => matchedPhrase.includes(kw))) {
                            type = 'gain';
                        } else if (lossKeywords.some(kw => matchedPhrase.includes(kw))) {
                            type = 'loss';
                        } else {
                            type = 'neutral';
                        }
                    }
                    
                    return { total, type };
                }

                recognition.onspeechend = () => {
                    recognition.stop();
                };
                
                recognition.onend = () => {
                    statusMessage.textContent = "Presiona para grabar";
                    statusMessage.classList.remove('text-red-500');
                    recordButton.classList.remove('hidden');
                    stopButton.classList.add('hidden');
                };

                recognition.onerror = (event) => {
                    let errorMessage = "Ocurri√≥ un error. Int√©ntalo de nuevo.";
                    if (event.error == 'no-speech') {
                        errorMessage = "No detectamos que hablaras. Int√©ntalo de nuevo.";
                    } else if (event.error == 'audio-capture') {
                        errorMessage = "No se encontr√≥ un micr√≥fono. Aseg√∫rate de que est√© conectado.";
                    } else if (event.error == 'not-allowed') {
                        errorMessage = "No diste permiso para usar el micr√≥fono. Act√≠valo en los ajustes de tu navegador.";
                    }
                    showModal('Error', `<p class="text-red-500 text-center">${errorMessage}</p>`);
                };

            } else {
                const recordCard = document.getElementById('recordCard');
                if(recordCard){
                    recordCard.innerHTML = `
                        <h2 class="font-bold">Funci√≥n no disponible</h2>
                        <p class="text-sm text-gray-600">Tu navegador no es compatible con el reconocimiento de voz. Te recomendamos usar Google Chrome.</p>
                    `;
                }
            }
        });
    </script>

</body>
</html>

